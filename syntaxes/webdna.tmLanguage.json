{
	"scopeName": "source.webdna",
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "WebDNA",
	"patterns": [ { "include": "#webdna" } ],
	"repository": {
		"webdna":{
			"patterns": [
				{ "include": "#comments" },
				{ "include": "#keywords" },
				{ "include": "#contexts-valid" },
				{ "include": "#functions-valid" },
				{ "include": "#tags-valid" },
				{ "include": "#strings" }
			]
		},
		"comments":{
			"begin": "\\[!\\]",
			"captures": {
				"0": {
					"name": "punctuation.definition.comment.webdna"
				}
			},
			"end": "\\[\/!\\]",
			"name": "comment.block.webdna"
		},
		"contexts-valid": {
			"patterns": [{
				"begin": "(?i)(\\[)(url)(?=\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "entity.name.tag.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			},{
				"begin": "(?i)(\\[/)(url)(?=\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "entity.name.tag.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			}]
		},
		"functions-valid":{
			"patterns": []
		},
		"keywords": {
			"patterns": [{
				"begin": "(?i)(\\[)\\b(if)\\b(?=\\s|\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "keyword.control.conditional.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				},
				"patterns": [{ "include": "#webdna" }]
			},{
				"begin": "(?i)(\\[)(else|then)(?=\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "keyword.control.conditional.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			},{
				"begin": "(?i)(\\[/)\\b(if|else|then)\\b(?=\\s|\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "keyword.control.conditional.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			},{
				"begin": "(?i)(\\[)(return)(?=\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "keyword.control.flow.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			},{
				"begin": "(?i)(\\[/)(return)(?=\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "keyword.control.flow.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			}]
		},
		"strings": {
			"patterns": [{
				"name": "string.quoted.double.webdna",
				"begin": "\"",
				"end": "\"",
				"patterns": [{
					"name": "constant.character.escape.webdna",
					"match": "\\\\."
				}]
			},{
				"patterns": [{
					"name": "string.quoted.single.webdna",
					"match": "'.*?'"
				}]
			}]
		},
		"tags-valid":{
			"patterns": [{
				"begin": "(?i)(\\[)\\b(browsername|cart|command|elapsedtime|flushdatabases|flushcache|freememory|httpmethod|ipaddress|issecureclient|lastautonumber|lastrandom|password|platform|product|referrer|referer|thisfile|thisurl|thisurlplusget|username|version)\\b(?=\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "support.function.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			},{
				"begin": "(?i)(\\[)([^ ]*?)(?=\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "variable.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			},{
				"begin": "(?i)(\\[)\\b(text|math)\\b(?=\\s|\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "storage.type.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				},
				"patterns": [{ "include": "#webdna" }]
			},{
				"begin": "(?i)(\\[/)\\b(text|math)\\b(?=\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "storage.type.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			},{
				"begin": "(?i)(\\[)\\b(date|random|time)\\b(?=\\s|\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "support.function.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				},
				"patterns": [{ "include": "#webdna" }]
			}]
		}
	}
}