{
	"scopeName": "source.webdna",
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "WebDNA",
	"patterns": [ { "include": "#webdna" } ],
	"repository": {
		"webdna":{
			"patterns": [
				{ "include": "#comments" },
				{ "include": "#keywords" },
				{ "include": "#storage" },
				{ "include": "#contexts-valid" },
				{ "include": "#functions-valid" },
				{ "include": "#tags-valid" },
				{ "include": "#strings" }
			]
		},

		"parameters":{
			"patterns": [
				{
					"begin": "(multi|s(cope|how))(?![\\w:-])",
					"beginCaptures": {
					  "0": {
						"name": "entity.other.parameter-name.webdna"
					  }
					},
					"comment": "WebDNA parameters",
					"end": "(?=\\s*+[^=\\s])",
					"name": "meta.parameter.$1.webdna",
					"patterns": [
					  { "include": "#parameter-interior" }
					]
				}
			]
		},


		"comments":{
			"begin": "\\[!\\]",
			"captures": {
				"0": {
					"name": "punctuation.definition.comment.webdna"
				}
			},
			"end": "\\[\/!\\]",
			"name": "comment.block.webdna"
		},


		"contexts-valid": {
			"patterns": [{
				"begin": "(?i)(\\[)\\b(applescript|capitalize|countchars|ddesend|dos|input|interpret|listdatabases|lineitems|raw|shell|spawn|unurl|url)\\b(?=\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "entity.name.tag.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			},{
				"begin": "(?i)(\\[/)\\b(applescript|capitalize|countchars|ddesend|dos|input|interpret|listdatabases|lineitems|raw|shell|spawn|unurl|url)\\b(?=\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "entity.name.tag.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			}]
		},

		"functions-valid":{
			"patterns": []
		},


		"keywords":{
			"patterns": [
				{ "include": "#keywords-valid" },
				{ "include": "#keywords-depreciated" }
			]
		},
		"keywords-conditional":{
			"patterns": [
				{ "include": "#keywords-conditional-depreciated" },
				{ "include": "#keywords-conditional-valid" }
			]
		},
		"keywords-conditional-depreciated":{
			"patterns": []
		},
		"keywords-conditional-valid":{
			"patterns": [{
				"begin": "(?i)(\\[)\\b(case|switch)\\b(?=\\s|\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "keyword.control.conditional.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				},
				"patterns": [{ 
					"begin": "(value)(?![\\w:-])",
					"beginCaptures": {
					  "0": {
						"name": "storage.type.parameter.webdna"
					  }
					},
					"comment": "WebDNA case/switch parameters",
					"end": "(?=\\s*+[^=\\s])",
					"name": "meta.parameter.$1.webdna",
					"patterns": [
					  { "include": "#parameter-interior" }
					]
				},{ 
					"include": "#webdna"
				}]
			},{
				"begin": "(?i)(\\[)\\b(hideif|if|showif)\\b(?=\\s|\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "keyword.control.conditional.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				},
				"patterns": [{ "include": "#webdna" }]
			},{
				"begin": "(?i)(\\[)(default|else|then)(?=\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "keyword.control.conditional.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			},{
				"begin": "(?i)(\\[/)\\b(case|default|else|hideif|if|then|showif|switch)\\b(?=\\s|\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "keyword.control.conditional.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			}]
		},
		"keywords-depreciated":{
			"patterns": [
				{ "include": "#keywords-conditional-depreciated" },
				{ "include": "#keywords-flow-depreciated" }
			]
		},
		"keywords-flow":{
			"patterns": [
				{ "include": "#keywords-flow-depreciated" },
				{ "include": "#keywords-flow-valid" }
			]
		},
		"keywords-flow-depreciated":{
			"patterns": [{
				"begin": "(?i)(\\[)(html1|html2|html3)(?=\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "invalid.deprecated.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			},{
				"begin": "(?i)(\\[/)(html1|html2|html3)(?=\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "invalid.deprecated.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			}]
		},
		"keywords-flow-valid":{
			"patterns": [{
				"begin": "(?i)(\\[)(return)(?=\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "keyword.control.flow.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			},{
				"begin": "(?i)(\\[/)(return)(?=\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "keyword.control.flow.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			},{
				"begin": "(?i)(\\[)(redirect)(?=\\s|\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "keyword.control.flow.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				},
				"patterns": [{ "include": "#parameters" }]
			},{
				"begin": "(?i)(\\[/)(redirect)(?=\\s|\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "keyword.control.flow.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			}]
		},
		"keywords-valid": {
			"patterns": [
				{ "include": "#keywords-conditional-valid" },
				{ "include": "#keywords-flow-valid" }
			]
		},

		"parameter-interior": {
			"patterns": [{
				"begin": "=",
				"beginCaptures": {
					"0": {
						"name": "punctuation.separator.key-value.webdna"
					}
				},
				"end": "(?<=[^\\s=])(?!\\s*=)|(?=\\])",
				"patterns": [
					{ "include": "#webdna" }
				]
			}]
		},



		"storage": {
			"patterns": [{
				"begin": "(?i)(\\[)\\b(text)\\b(?=\\s|\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "storage.type.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				},
				"patterns": [{
					"begin": "(multi|s(ecure|cope|how))(?![\\w:-])",
					"beginCaptures": {
					  "0": {
						"name": "storage.type.parameter.webdna"
					  }
					},
					"comment": "WebDNA parameters",
					"end": "(?=\\s*+[^=\\s])",
					"name": "meta.parameter.$1.webdna",
					"patterns": [
					  { "include": "#parameter-interior" }
					]
				}]
			},{
				"begin": "(?i)(\\[)\\b(math)\\b(?=\\s|\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "storage.type.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				},
				"patterns": [{
					"begin": "(s(ecure|cope|how))(?![\\w:-])",
					"beginCaptures": {
					  "0": {
						"name": "storage.type.parameter.webdna"
					  }
					},
					"comment": "WebDNA parameters",
					"end": "(?=\\s*+[^=\\s])",
					"name": "meta.parameter.$1.webdna",
					"patterns": [
					  { "include": "#parameter-interior" }
					]
				},{
					"begin": "(date|time)(?![\\w:-])",
					"beginCaptures": {
					  "0": {
						"name": "storage.type.parameter.webdna"
					  }
					},
					"comment": "WebDNA parameters",
					"end": "(?=\\s*+[^=\\s])",
					"name": "meta.parameter.$1.webdna",
					"patterns": [
					  { "include": "#webdna" }
					]
				}]
			},{
				"begin": "(?i)(\\[/)\\b(text|math)\\b(?=\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "storage.type.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			}]
		},

		"strings": {
			"patterns": [{
				"name": "string.quoted.double.webdna",
				"begin": "\"",
				"end": "\"",
				"patterns": [{
					"name": "constant.character.escape.webdna",
					"match": "\\\\."
				}]
			},{
				"patterns": [{
					"name": "string.quoted.single.webdna",
					"match": "'.*?'"
				}]
			}]
		},
		"tags-valid":{
			"patterns": [{
				"begin": "(?i)(\\[)\\b(browsername|cart|command|elapsedtime|flushdatabases|flushcache|freememory|httpmethod|ipaddress|issecureclient|lastautonumber|lastrandom|password|platform|product|referrer|referer|thisfile|thisurl|thisurlplusget|username|version)\\b(?=\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "support.function.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			},{
				"begin": "(?i)(\\[)\\b(authenticate|calcfilecrc32|clearlineitems|closedatabase|commitdatabase|copyfile|copyfolder|createfolder|date|delete|deletefile|deletefolder|filecompare|getcookie|getmimeheader|include|lookup|movefile|protect|purchase|random|removelineitem|renamefile|setcookie|setmimeheader|time|validcard|findstring)\\b(?=\\s|\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "support.function.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				},
				"patterns": [{ "include": "#parameters" }]
			},{
				"begin": "(?i)(\\[)([^ ]*?)(?=\\])",
				"beginCaptures": {
					"1": {
						"name": "punctuation.definition.tag.begin.webdna"
					},
					"2": {
						"name": "variable.webdna"
					}
				},
				"end": "\\]",
				"endCaptures": {
					"0": {
						"name": "punctuation.definition.tag.end.webdna"
					}
				}
			}]
		}
	}
}